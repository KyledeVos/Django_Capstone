<!-- HTML Page for Individual Product View including Price and Size Selection,
    Quantity and Add to Order Functionality-->

<!-- Extend page_base allowing for User Login and SignUp options to be accessible-->
{% extends "page_base.html" %}
{% load static %}

{% block content %}

    <a class = " my-2 btn btn-outline-dark" href="{%url 'product_site:site_home' %}">All Products</a>
    <br>

    {% if not logged_in %}
        <h4 style = "color: blueviolet;">Login for Order Placement</h4>
    {% endif %}
    <br>

    <div class = "row border border-1">
        <!--Product Category, Tile and Main Image-->
        <figure class = "col-xxl-3 border border-1 text-center">
            <!-- Title -->
            <h2 style="font-family:''Arial Narrow', Arial, sans-serif;" >{{product.title}}</h2>
            <!-- Category -->
            <h4 style="font-family: Brush Script MT;"> {{product.category}}</h4>
            <!-- Review Rating-->
            {% if product.review_value == 0 %}
                &nbsp
            {% else %}
                Rating: {{product.review_value}}<br>
            {% endif %}
            <img class = "my-2 card-img-top rounded"
                style="width: 80%; max-height: 500px; border: 3px solid goldenrod;"
                src="{{product.product_image.url}}"> <br>
                
        </figure>

        <!-- Product Labels, Pricing and Options Selection-->
        <div class = "col-xxl-4 border border-1">

            <!-- Labels -->
            {% for label in labels %}
                <div class = "text-start my-1 px-1 rounded fw-bold text-truncate "
                    style=" width: 150px; color: white; background-color: {{label.custom_colour}};">
                    {{label}}
                </div>
            {% endfor %}

            <!-- Discount Notification-->
            {% if discount_bool %}
                <h4 class = "my-2 text-center" style="color:deepskyblue;">On Discount</h4>
            {% endif %}

            <!--LOGGED IN - ALLOW SUBMISSION FOR PRICING, QUANTITY AND OPTIONS-->

            {% if logged_in %}
                {% if error != 'none' %}
                <!-- Display Error for Order Submission without price selection-->
                    <h5 style="color: red;"><strong>Price was not selected</strong></h5>
                {% endif %}
                <h4>Select the Size(s) you would like</h4>
                <form action="{% url 'product_site:create_order_item' product_id=product.id %}" method="post">
                    {% csrf_token %}
        
                    <!--PRICING-->
                    {% for size_price in price_list %}
                        <input type="checkbox" name="selected_sizes" value="{{size_price.id}}"/>

                        {% if size_price.size == 'none' %}
                            <label for="{{size_price}}.size">
                                Base Price:
                            </label>
                            <label for="{{size_price}}.price">
                                <strong>R{{size_price.price}}</strong>
                            </label> 
                            
                            <input type="number" name="{{size_price.size}} quantity" min="1" placeholder="Quantity">
                        {% else %}
                            {{size_price.size}}: <strong>R{{size_price.price}}</strong>
                            <input type="number" name="{{size_price.size}} quantity" min="1" placeholder="Quantity">
                        {% endif %}
                            <br>    
                    {% endfor %}

        <!--OPTIONS-->
        <h3>Addtional Options</h3>
        <!--Options not Compulsory for a Product-->
        {% if options %}
        <h4>Select any options you would like to add:</h4>
            {% for option in options %}
            <input type="checkbox" name="product_options" value="{{option.id}}"/>  
                {{option.title}}: {{option.description}}
                <br>
            {% endfor %}
        {% endif %}
        

        <!--FORM SUBMISSION-->
        <input type="submit" value="Add to Order">
    </form>

    <!--NOT LOGGED IN - SHOW PRICING, QUANTITY AND OPTIONS WITH NO SUBMISSION-->
    {% else %}

        <!--PRICING-->
        {% for size_price in price_list %}
            {% if size_price.size == 'none' %}
                Base Price: R{{size_price.price}}
            {% else %}
                {{size_price.size}}: R{{size_price.price}}
            {% endif %}
                <br>
        {% endfor %}

        <!--OPTIONS-->
        <h3>Addtional Options</h3>
        {%if options %}
        <h3>Options</h3>
        {% for option in options %}
            {{option.title}}: {{option.description}}
            <br>
        {% endfor %}
    {% endif %}


    {% endif %}

            
        </div>

        <div class="col-xxl-3 border border-1">
            <pre style="max-width: 90%; max-height: 500px; padding: 5px;
                overflow-y: auto; overflow-x:hidden;
                white-space: break-spaces; background-color:aquamarine;
                font-family: Cursive; text-align: justify;
                border: 2px solid rgb(234, 192, 234);">{{product.description}}
            </pre><br>

        </div>
    
    </div>

    

        <!-- Additonal Product Images -->
    {% for image in product_images %}
        <img style="width: 200px;" src="{{image.image.url}}">
        <br>
        <br>
    {% endfor %}


{% endblock %}